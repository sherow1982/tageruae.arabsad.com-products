<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>منتجات تاجر الإمارات</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="اكتشف منتجات تاجر الإمارات مباشرة من EasyOrders. تسوق بسهولة وبسرعة من أي جهاز.">
<meta property="og:title" content="منتجات تاجر الإمارات">
<meta property="og:description" content="تسوق بسهولة وبسرعة من EasyOrders. منتجات عالية الجودة وبأسعار رائعة.">
<meta property="og:type" content="website">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PGQ56ZQZ');</script>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MR5ZR9ZQNC"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-MR5ZR9ZQNC');
</script>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
body{font-family:'Tajawal',sans-serif;background:#f9fafb;margin:0;padding:0}
h1{text-align:center;font-size:2rem;color:#1D4ED8;margin:20px 0}
#search-container{max-width:600px;margin:0 auto 20px auto;position:relative}
#search{width:100%;padding:12px 16px;font-size:1rem;font-weight:bold;border-radius:10px;border:2px solid #00BFFF;outline:none}
#search:focus{border-color:#1E40AF}
#search-results{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;max-height:250px;overflow-y:auto;border-radius:0 0 10px 10px;z-index:100;display:none}
#search-results a{display:block;padding:10px;text-decoration:none;color:#444;font-weight:bold;border-bottom:1px solid #eee}
#search-results a:hover{background:#00BFFF;color:#fff}
#products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;padding:20px}
.card{background:#fff;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);display:flex;flex-direction:column;height:100%;overflow:hidden}
.card img{width:100%;height:auto;max-height:250px;object-fit:contain;border-radius:10px 10px 0 0;cursor:pointer;opacity:0;transition:opacity 0.8s ease-in-out}
.card img.loaded{opacity:1}
.card-content{padding:10px;display:flex;flex-direction:column;justify-content:flex-start;flex-grow:1}
.title{font-weight:bold;font-size:1rem;color:#444;text-align:center;margin-bottom:5px}
.price-fixed{font-weight:bold;text-align:center;font-size:1.2rem;color:#006400;margin-bottom:5px}
.btn{text-align:center;padding:8px;border-radius:8px;font-weight:bold;text-decoration:none;display:block;margin-top:auto;background:#00BFFF;color:#fff;transition:0.3s}
.btn:hover{background:#009ACD}
#whatsapp-btn{position:fixed;bottom:20px;right:20px;background:#fff;color:#8B0000;font-weight:bold;font-size:0.9rem;padding:10px 14px;border-radius:50px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 10px rgba(0,0,0,0.2);z-index:1000;text-decoration:none}
#whatsapp-btn:hover{transform:scale(1.1);box-shadow:0 8px 20px rgba(0,0,0,0.3)}
#whatsapp-btn svg{width:20px;height:20px;fill:#25D366;margin-left:5px}
@media(max-width:768px){.card img{max-height:200px}.price-fixed{font-size:1.1rem}}
@media(max-width:480px){.card img{max-height:150px}.title{font-size:0.9rem}.price-fixed{font-size:1rem}}
</style>
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PGQ56ZQZ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<h1>منتجات تاجر الإمارات</h1>
<div id="search-container">
  <input type="text" id="search" placeholder="ابحث عن منتج...">
  <div id="search-results"></div>
</div>

<div id="products"><p class="text-center text-gray-500">جاري تحميل المنتجات...</p></div>

<a href="https://wa.me/201110760081" target="_blank" id="whatsapp-btn">راسلنا واتساب<svg viewBox="0 0 448 512"><path d="M380.9 97.1C339-8.4 229.2-20.5 153.3 31.2 109.8 60.3 79.8 105.2 72.1 154.7 64.3 204.1 79.6 252 109.1 293.1L84.3 424.7 214.7 399.9C256 414.3 302.7 408 342.9 381.5 404.2 345.1 432.3 278.2 424.6 212.2 417 146.1 386.5 91.3 380.9 97.1ZM224 272C190.1 272 160 241.9 160 208S190.1 144 224 144s64 30.1 64 64-30.1 64-64 64Z"/></svg></a>

<script>
const FEED_URL = "https://api.easy-orders.net/api/v1/products/feed/437a38bb829245a3934e1d2fe153b417/channel/google";
let productsData = [];

function cleanText(t){return t?t.replace(/[*•\-\u00A0]/g,"").trim():""}

async function loadProducts(){
  try{
    const r = await fetch(FEED_URL);
    const text = await r.text();
    const parser = new DOMParser();
    const xml = parser.parseFromString(text,"application/xml");
    const items = xml.querySelectorAll("item");
    const container = document.getElementById("products");
    container.innerHTML="";
    const frag=document.createDocumentFragment();

    items.forEach(i=>{
      const t = cleanText(i.querySelector("title")?.textContent) || "منتج بدون اسم";
      const l = i.querySelector("link")?.textContent || "#";
      const imgSrcFull = i.querySelector("g\\:image_link, image_link")?.textContent || "";
      const imgThumb = imgSrcFull; // يمكن إضافة رابط thumbnail مختلف إذا متوفر
      const p = parseFloat((i.querySelector("g\\:price, price")?.textContent||"0").replace(/[^\d.]/g,""))||0;
      productsData.push({title:t,link:l,image:imgSrcFull,price:p});

      const card = document.createElement("div"); card.className="card";

      const aImg = document.createElement("a"); aImg.href=l; aImg.target="_blank";
      const img = document.createElement("img"); img.src=imgThumb; img.alt=t; img.loading="lazy";
      img.dataset.srcFull = imgSrcFull;
      img.addEventListener("load",()=>img.classList.add("loaded"));
      aImg.appendChild(img);
      card.appendChild(aImg);

      const content = document.createElement("div"); content.className="card-content";
      const titleEl = document.createElement("div"); titleEl.className="title"; titleEl.textContent=t;
      const priceEl = document.createElement("div"); priceEl.className="price-fixed"; priceEl.textContent=p+" درهم";
      const btn = document.createElement("a"); btn.className="btn"; btn.href=l; btn.target="_blank"; btn.textContent="تسوق بسهولة بالضغط هنا";

      content.appendChild(titleEl); content.appendChild(priceEl); content.appendChild(btn);
      card.appendChild(content);
      frag.appendChild(card);
    });

    container.appendChild(frag);
    lazyLoadImages();

  } catch(err){
    console.error(err);
    document.getElementById("products").innerHTML="<p class='text-center text-red-500'>فشل تحميل المنتجات من الفييد مباشرة.</p>"
  }
}

// Lazy loading advanced
function lazyLoadImages(){
  const imgs = document.querySelectorAll('img[data-src-full]');
  const options = {root:null,rootMargin:"0px",threshold:0.1};
  const observer = new IntersectionObserver((entries, obs)=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting){
        const img = entry.target;
        img.src = img.dataset.srcFull;
        obs.unobserve(img);
      }
    });
  }, options);

  imgs.forEach(img=>observer.observe(img));
}

loadProducts();

// Dynamic search
const searchInput = document.getElementById("search"), searchResults=document.getElementById("search-results");
function highlightMatch(t,e){const r=new RegExp(`(${e})`,"gi");return t.replace(r,"<span style='background:#00BFFF;color:#fff;'>$1</span>")}
searchInput.addEventListener("input",()=>{
  const val=searchInput.value.trim().toLowerCase();
  if(val.length<2){searchResults.style.display="none"; searchResults.innerHTML=""; return}
  const matches=productsData.filter(p=>p.title.toLowerCase().includes(val));
  if(matches.length===0){searchResults.innerHTML="<div style='padding:10px;color:#999;'>لا توجد نتائج</div>";searchResults.style.display="block"; return}
  searchResults.innerHTML="";
  matches.forEach(p=>{const a=document.createElement("a"); a.href=p.link; a.target="_blank"; a.innerHTML=highlightMatch(p.title,val); searchResults.appendChild(a)});
  searchResults.style.display="block";
});
</script>
</body>
</html>
