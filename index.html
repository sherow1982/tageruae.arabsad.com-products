<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>منتجات تاجر الإمارات</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
body { font-family: 'Tajawal', sans-serif; background-color: #f9fafb; margin:0; padding:0; }
h1 { text-align:center; font-size:2rem; color:#1D4ED8; margin:20px 0; }
#products {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 20px;
  padding: 20px;
}
.card {
  background:#fff;
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);
  transition: transform 0.2s;
  display:flex;
  flex-direction:column;
}
.card:hover { transform: scale(1.03); }
.card img {
  width:100%;
  height:auto;
  max-height:250px;
  object-fit:contain;
  border-radius:10px 10px 0 0;
  cursor:pointer;
}
.card-content {
  padding:10px;
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  flex-grow:1;
}
.title { font-weight:bold; font-size:1rem; color:#444; text-align:center; margin-bottom:5px; }
.description { font-size:0.9rem; color:#555; margin-bottom:5px; overflow:hidden; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; }
.price-new { color:green; font-weight:bold; text-align:center; font-size:1.2rem; margin-bottom:5px; }
.btn, .btn-more {
  text-align:center;
  padding:6px;
  border-radius:6px;
  font-weight:bold;
  text-decoration:none;
  display:block;
  margin-top:5px;
  transition:0.2s;
}
.btn { background:#FFEF00; color:#000; } /* أخضر الكناري تقريبا */
.btn:hover { background:#E6DD00; }
.btn-more { color:green; font-weight:bold; font-style:italic; background:#e0f7ea; }
.btn-more:hover { background:#c0f0d5; }

/* WhatsApp floating button */
#whatsapp-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background:#fff;
  color:#8B0000;
  font-weight:bold;
  font-size:0.9rem;
  padding:10px 14px;
  border-radius:50px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 4px 10px rgba(0,0,0,0.2);
  z-index:1000;
  transition:transform 0.2s;
  cursor:pointer;
  text-decoration:none;
}
#whatsapp-btn:hover { transform: scale(1.1); }
#whatsapp-btn svg { width:20px; height:20px; fill:#25D366; margin-left:5px; }

@media (max-width:768px){ .card img{max-height:200px;} .price-new{font-size:1.1rem;} }
@media (max-width:480px){ .card img{max-height:150px;} .title{font-size:0.9rem;} .price-new{font-size:1rem;} }
</style>
</head>
<body>

<h1>منتجات تاجر الإمارات</h1>
<div id="products">
  <p class="text-center text-gray-500">جاري تحميل المنتجات...</p>
</div>

<!-- WhatsApp Floating Button -->
<a href="https://wa.me/201110760081" target="_blank" id="whatsapp-btn">
  راسلنا واتساب
  <svg viewBox="0 0 448 512"><path d="M380.9 97.1C339-8.4 229.2-20.5 153.3 31.2 109.8 60.3 79.8 105.2 72.1 154.7 64.3 204.1 79.6 252 109.1 293.1L84.3 424.7 214.7 399.9C256 414.3 302.7 408 342.9 381.5 404.2 345.1 432.3 278.2 424.6 212.2 417 146.1 386.5 91.3 380.9 97.1ZM224 272C190.1 272 160 241.9 160 208S190.1 144 224 144s64 30.1 64 64-30.1 64-64 64Z"/></svg>
</a>

<script>
const FEED_URL = "https://api.easy-orders.net/api/v1/products/feed/437a38bb829245a3934e1d2fe153b417/channel/google";

async function loadProducts() {
  try {
    const res = await fetch(FEED_URL);
    const text = await res.text();
    const parser = new DOMParser();
    const xml = parser.parseFromString(text, "application/xml");
    const items = xml.querySelectorAll("item");
    const container = document.getElementById("products");
    container.innerHTML = "";

    items.forEach(item=>{
      const title = item.querySelector("title")?.textContent || "منتج بدون اسم";
      const link = item.querySelector("link")?.textContent || "#";
      const image = item.querySelector("g\\:image_link, image_link")?.textContent || "";
      const priceAfter = parseFloat((item.querySelector("g\\:price, price")?.textContent || "0").replace(/[^\d.]/g,"")) || 0;
      const desc = item.querySelector("description")?.textContent || "";

      const card = document.createElement("div");
      card.className = "card";

      const aImg = document.createElement("a");
      aImg.href = link;
      aImg.target="_blank";
      const img = document.createElement("img");
      img.src = image;
      img.alt = title;
      img.loading="lazy";
      aImg.appendChild(img);
      card.appendChild(aImg);

      const content = document.createElement("div");
      content.className="card-content";

      const t = document.createElement("div");
      t.className="title";
      t.textContent=title;

      const d = document.createElement("div");
      d.className="description";
      d.textContent=desc;

      const btnMore = document.createElement("a");
      btnMore.className="btn-more";
      btnMore.href="javascript:void(0)";
      btnMore.textContent="عرض المزيد";
      btnMore.addEventListener("click",()=>{
        if(d.style.webkitLineClamp === "3" || !d.style.webkitLineClamp) {
          d.style.display = "block";
          d.style.webkitLineClamp = "unset";
          btnMore.textContent="عرض أقل";
        } else {
          d.style.display = "-webkit-box";
          d.style.webkitLineClamp = "3";
          btnMore.textContent="عرض المزيد";
        }
      });

      const pNew = document.createElement("div");
      pNew.className="price-new";
      pNew.textContent=priceAfter + " درهم";

      const btn = document.createElement("a");
      btn.className="btn";
      btn.href=link;
      btn.target="_blank";
      btn.textContent="اشترِ الآن";

      content.appendChild(t);
      content.appendChild(d);
      content.appendChild(btnMore);
      content.appendChild(pNew);
      content.appendChild(btn);

      card.appendChild(content);
      container.appendChild(card);
    });

  } catch(err){
    console.error(err);
    document.getElementById("products").innerHTML="<p class='text-center text-red-500'>فشل تحميل المنتجات من الفييد مباشرة.</p>";
  }
}

loadProducts();
</script>

</body>
</html>
